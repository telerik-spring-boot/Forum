<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/general-fragments.html :: head('Post')}"></head>

<body class="sb-nav-fixed">
<nav th:replace="~{fragments/general-fragments.html :: topnav}"></nav>

<div id="layoutSidenav">
    <div th:replace="~{fragments/general-fragments.html :: sidenav}"></div>
    <div id="layoutSidenav_content">
        <main>
            <div class="container-fluid px-4 mt-4">

                <div class="card mb-4">
                    <div class="card-header" style="font-size: 36px;">
                        <span th:text="${post.title}"></span>

                        <p class="text-muted text-content" style="font-size: 16px; margin-top: 16px;">
                            Posted by
                            <a class="text-content"
                               th:href="@{/users/{id}/overview(id=${post.userId})}"
                               th:text="${post.creatorUsername}">
                                User
                            </a>
                            on
                            <span class="text-content"
                                  th:text="${#temporals.format(post.createdAt, 'dd-MM-yyyy HH:mm')}">Date</span>
                        </p>


                    </div>



                    <div class="card-body">

                        <div class="d-flex justify-content-between align-items-center">
                            <!-- Tag List -->
                            <div class="tags-container">
                                <span class="tag" th:each="tag : ${post.tags}">
                                    <a th:href="@{/search/tags/{tagName}(tagName=${tag})}" th:text="${tag}">Tag</a>
                                </span>
                            </div>
                            <!-- Update and Delete buttons -->
                            <div class="d-flex justify-content-end tags-container">
                                <a href="#" th:if="${userIsCreator && !userIsBlocked}" th:href="@{__${requestURI}__/update}"
                                   class="btn btn-primary btn-sm rounded-pill">Update</a>
                                <a href="#" th:if="${(userIsCreator || userIsAdmin) && !userIsBlocked}"
                                   data-bs-toggle="modal" data-bs-target="#deleteModal"
                                   th:data-href="@{/posts/{id}/delete(id=${post.id})}"
                                   class="btn btn-danger btn-sm rounded-pill">Delete</a>
                            </div>
                        </div>

                        <div th:text="${post.content}" style="font-size: 24px; margin-top: 20px; "></div>

                        <!-- Delete Modal -->
                        <div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel"
                             aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        <h5 class="modal-title" id="deleteModalLabel">Are you sure you want to delete this
                                            post?</h5>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                        <a href="#" id="confirmDelete" class="btn btn-danger"
                                           th:href="@{/posts/{id}/delete(id=${post.id})}">Delete</a>
                                    </div>
                                </div>
                            </div>
                        </div>



                    </div>

                </div>
                <div class="comments-section mt-4">
                    <h6>Comments</h6>
                    <div th:each="comment : ${post.comments}">
                        <div class="comment-box">
                            <p class="text-muted text-content" style="font-size: 14px;">

                                <a class="text-content"
                                   th:href="@{/users/{id}/overview(id=${comment.creatorId})}"
                                   th:text="${comment.creatorUsername}">
                                    User
                                </a>
                                on
                                <span class="text-content"
                                      th:text="${#temporals.format(comment.createdAt, 'dd-MM-yyyy HH:mm')}">Date</span>
                            </p>
                                <p th:text="${comment.commentContent}" style="font-size: 16px" >Comment content</p>

                        </div>
                    </div>
                </div>

                <div class="card-body mb-4">

                    <form action="#" method="post" th:action="@{/posts/{id}(id=${post.id})}" th:object="${commentCreateDto}">
                        <div class="mb-3">
                            <h6>Add a Comment</h6>
                            <label for="textarea"></label><textarea class="form-control" id="textarea" placeholder="Write your comment here..." rows="3"
                                                                    th:classappend="${#fields.hasErrors('content') ? 'is-invalid' : ''}"
                                                                    th:field="*{content}"></textarea>
                            <div class="invalid-feedback" th:errors="*{content}"
                                 th:if="${#fields.hasErrors('content')}"></div>
                        </div>
                        <button class="btn btn-primary" type="submit">Post Comment</button>
                    </form>
                </div>


            </div>


        </main>
        <footer th:replace="~{fragments/general-fragments.html :: footer}"></footer>
    </div>
</div>


<th:block th:replace="~{fragments/general-fragments.html :: scripts}"></th:block>
</body>
</html>
